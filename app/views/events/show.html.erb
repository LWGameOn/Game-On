<div class="container">
    <div class="show">
      <%= image_tag "event_background.jpg", style: "width:100%; height:320px; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25)" %>
        <div class="container card-info">
          <h1 class="card-title"> <%= @event.name %></h1>
          <p class="fw-light text-font"><%= @event.sport.capitalize %></p>
          <p class="fw-light text-font">Created by <%= link_to "@#{(@event.user == current_user ? "you" : @event.user.username)}", user_path(@event.user) %></p>
        </div>
        <div class="card p-3 mx-3">
            <p class="card-comp" ><i class="fa-solid fa-location-dot"></i>&nbsp&nbsp&nbsp<%= @event.location %></p>
            <p class="card-comp" ><i class="fa-solid fa-calendar-days"></i>&nbsp&nbsp&nbsp<%= @event.date.strftime('%a %d %b %Y') %></p>
            <p class="card-comp" ><i class="fa-regular fa-clock"></i>&nbsp&nbsp&nbsp<%= @event.date.strftime('%I:%M %p') %> </p>
            <p class="card-comp" ><i class="fa-solid fa-user"></i>&nbsp&nbsp&nbsp<%= @event.capacity - (@event.plays.count ? @event.plays.count : 0) %> more spots</p>
          <div class="pb-3 card-comp">
          <%= @event.description %>
          </div>
            <% if @has_joined %>
              <h3>You have joined this fun game</h3>
              <p class="mt-2"><%= link_to "Chat", chatroom_path(@event.id), class:"btn1" %></p>
            <% else %>
            <%= simple_form_for [@event, @play] do |f| %>
            <div class="btn-wrapper d-flex justify-content-between">
              <p class="mt-2"><%= link_to "Chat", chatroom_path(@event.id), class:"btn1" %></p>
              <p class="mt-2"><%= @event.user_id != current_user.id ? (f.submit "JOIN", class: "btn1") : (link_to "Delete this event", event_path(@event), data: { turbo_method: :delete, confirm: 'Are You sure?' }, class:"btn-report") %></p>
            </div>
            <% end %>
          <% end %>
        </div>
        <% if @event.user_id == current_user.id %>
          <div class="participants container mt-3">
            <h3 class="card-title">Participants</h3>
            <ul>
            <% @event.plays.each do |play| %>
              <% if play.user != current_user %>
                <li><%= link_to play.user.username, user_path(play.user.id), class:"card-comp" %></li>
              <% end %>
            <% end %>
            </ul>
          </div>
        <% end %>
    </div>

    <div class="review mt-3">
      <div class="row mb-3">
        <%= simple_form_for [@event, @review] do |f| %>
          <%= f.input :content, label:"Write a review"%>
          <%= f.submit class: 'btn1' %>
        <% end %>
      </div>

      <% if @event.date.after?(DateTime.now) %>
        <ul class="list-group list-group-light">
          <% @event.reviews.each do |review| %>
            <li class="list-group-item border-0">

            <div class="row text-center m-1">
              <div class="col-md-6 mb-4 mb-md-0">
                <% if review.user.avatar.attached? %>
                  <div class="d-flex justify-content-center mb-4">
                    <%= cl_image_tag(review.user.avatar.key, class: "avatar-bordered") %>
                  </div>
                <% end %>
                <p class="lead my-3 text-muted justify-content-center mb-4 ">
                  <i class="fas fa-quote-left pe-1"></i> <%= review.content%></p>
                  <p class="font-italic font-weight-normal mb-3"><%= link_to "@" + review.user.username, user_path(review.user.id), class:"card-comp" %></p>
                </div>
              </div>

              <div class="button mb-1 d-flex justify-content-end">
                <%if current_user.reviews.include?(review)%>
                  <%= link_to review_path(review),
                  data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class:"btn1" do %>
                  <i class="fa-solid fa-trash-can"></i>
                  <% end %>
                <% end %>
              </div>
            </li>
          <% end %>
        <ul>
      <% end %>

    </div>

</div>
